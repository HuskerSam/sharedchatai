<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Embedding</title>
    <link rel="shortcut icon" href="/images/logo64.png" />
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-firestore.js"></script>
    <script src="/__/firebase/init.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <style>
        label {
            font-weight: bold;
            display: block;
        }
    </style>
    <script>
        window.addEventListener("load", async (event) => {
            document.querySelector(".scrape_urls_btn").addEventListener("click", () => scrapeURLs());
            document.querySelector(".run_prompt").addEventListener("click", () => runPrompt());
            document.querySelector(".delete_index").addEventListener("click", () => deleteIndex());
            document.querySelector(".copy_results_to_clipboard").addEventListener("click", () => {
                const data = document.querySelector(".results_div").innerHTML;
                navigator.clipboard.writeText(data);
            });
        });

        async function scrapeURLs() {
            const urls = document.querySelector(".urls_to_scrape").value;
            const batchId = document.querySelector(".batch_id").value;
            window.StaticPageApp.embedURLContent(urls, batchId);
        }

        async function runPrompt() {
            const prompt = document.querySelector(".prompt_area").value;
            const batchId = document.querySelector(".batch_id").value;
            window.StaticPageApp.queryEmbeddings(prompt, batchId);
        }
        
        async function deleteIndex() {
            const batchId = document.querySelector(".batch_id").value;
            window.StaticPageApp.deleteIndex(batchId);
        }
    </script>
    <script>
        window.addEventListener("load", async (event) => {
            let module = await import("/models/staticpageapp.js");
            window.StaticPageApp = new module.StaticPageApp();
        });
    </script>
</head>

<body>
    <div style="padding: 20px;"">
        <h2>Embeddings</h2>
        <label>Index Name</label>
        <input class="batch_id" type="text" value="usda">
        &nbsp; &nbsp;
        <button class="delete_index btn btn-primary">Delete Pinecone Index</button>
        <hr>
        <label>Scrape URLs (1 per line)</label>
        <textarea style="width:90%" class="urls_to_scrape" rows="6">https://www.usda.gov/peoples-garden/gardening-advice
https://www.nal.usda.gov/plant-production-gardening/vegetable-gardening
https://extension.umn.edu/planting-and-growing-guides/starting-seeds-indoors
https://www.usda.gov/peoples-garden/gardening-advice/container-gardening
https://www.nrcs.usda.gov/conservation-basics/natural-resource-concerns/plants
        </textarea>
        <br>
        <br>
        <button class="scrape_urls_btn btn btn-primary">Scrape URLs</button>
        <br>
        - wait 20-30 seconds after upserting items before trying to query them
        <hr>
        <label>Prompt</label>
        <textarea class="prompt_area" style="width:20em;max-width: 90%;" rows="6">How do I save seeds from my garden for next year?</textarea>
        <br>
        <br>
        <button class="run_prompt btn btn-primary">Prepare Prompt</button>
        <br>
        <br>
        <label>Prepare Prompt Results</label>
        <br>
        <h2>Prepared Prompt</h2>
        <button class="copy_results_to_clipboard btn btn-primary">Copy to Clipboard</button>
        <div class="results_div" style="min-height:5em;padding:10px;white-space:pre-wrap"></div>
        <br><br>
        <h2>Top 3 results from Pinecone query</h2>
        <table class="results_table"></table>
    </div>
</body>
</html>