<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bible Embedding Example</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <script type="module">
    import { loadModule } from 'https://klesun.github.io/ts-browser/src/ts-browser.js';
    window.addEventListener("load", async () => {
      // I don't know no javascript - so I use typescript...
      const mod = await loadModule('./bibledemo.ts');
      window.appInstance = new mod.BibleDemoApp();
    });
  </script>
</head>

<body class="d-flex h-100 text-center text-black initial">
  <div class="container-xl d-flex flex-column h-100 w-100 mx-auto">


    <div class="tab-content" style="margin-top:auto;margin-bottom:auto;">
      <div class="tab-pane fade show active" id="augmented_response_view" role="tabpanel"
        aria-labelledby="augmented_response_button">
        <div class="d-grid gap-2 pt-4 pt-sm-2">
          <textarea class="analyze_prompt_textarea form-control-lg" style="" placeholder="Enter your prompt"
            type="text"></textarea>
          <button class="analyze_prompt_button btn btn-success" type="submit">Process Bible Lookup</button>
        </div>
        <div class="row align-items-md-stretch text-start py-3">
          <div class="col-md-6 pe-md-1">
            <div class="h-100 p-3 bg-light text-dark border rounded border-2" style="background-image: var(--bs-gradient);">
              <div class="my-1 tab-content" style="height:50vh;overflow: auto;overflow-x: unset;">
                <div class="tab-pane fade show active" id="chapters_view" role="tabpanel"
                  aria-labelledby="chapters_view_button">
                  <div class="initial_user_message text-muted" style="cursor: not-allowed;">Enter a prompt to discover most relevant bible chapters</div>
                  <div class="lookup_chapter_response_feed"></div>
                  <a type="button" class="nav-link text-center pipeline_detail_anchor_hide" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Chapter Fetch Pipeline Detail
                  </a>
                </div>
                <div class="tab-pane fade" id="verses_view" role="tabpanel" aria-labelledby="verses_view_button">
                  <div class="initial_user_message text-muted" style="cursor: not-allowed;">Enter a prompt to discover most relevant bible verses</div>
                  <div class="lookup_verse_response_feed"></div>
                  <a type="button" class="nav-link text-center pipeline_detail_anchor_hide" data-bs-toggle="modal" data-bs-target="#exampleModal2">
                    Verse Fetch Pipeline Detail
                  </a>
                </div>
                <div class="tab-pane fade" id="full_augmented_prompt_view" role="tabpanel"
                  aria-labelledby="full_augmented_prompt_view">
                  <div class="initial_user_message text-muted" style="cursor: not-allowed;">Enter a prompt to see details</div>
                  <div class="summary_details"></div>
                </div>
              </div>
              <ul class="nav nav-pills justify-content-center border-top pt-3">
                <li class="nav-item"><a class="nav-link active" id="chapters_view_button" data-bs-toggle="tab"
                    href="#chapters_view" role="tab" aria-controls="chapters_view" aria-selected="true">
                    Chapters
                  </a></li>
                <li class="nav-item">
                  <a class="nav-link" id="verses_view_button" data-bs-toggle="tab" href="#verses_view" role="tab"
                    aria-controls="verses_view" aria-selected="false">
                    Verses
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="full_augmented_prompt_button" data-bs-toggle="tab"
                    href="#full_augmented_prompt_view" role="tab" aria-controls="full_augmented_prompt_view"
                    aria-selected="false">
                    Details
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-6 ps-md-1 pt-md-0 pt-2">
            <div class="h-100 p-3 bg-dark text-white border border-secondary border-2 rounded" style="background-image: var(--bs-gradient);">
              <div class="my-1" style="height:50vh;overflow: auto;overflow-x: unset;">
                <div class="full_augmented_response"></div>
              </div>
              <div class="augmented_response_user_msg text-center border-top pt-3 border-secondary">
                Your Augmented Response
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade text-start py-2" id="augmented_template_view" role="tabpanel"
        aria-labelledby="augmented_template_button">
        <div class="row align-items-md-stretch">
          <div class="col-md-6 p-2">
            <div class="h-100 p-4 bg-light rounded-3 border border-secondary">
              <div class="small mb-4 text-muted">Prompt Template</div>
              <select class="form-select prompt_template_select_preset">
                <option selected>Augmented Response</option>
                <option>Write a new chapter</option>
                <option>Provide guidance</option>
                <option>Judge if embeds politically correct</option>
              </select>
              <br>
              <label>Prompt Template: </label><br>
              <textarea style="height:15em;width:100%;" class="prompt_template_text_area"></textarea>
              <br>
              <br>
              <label>Embed Template: </label><br>
              <textarea style="height:5em;width:100%;" class="document_template_text_area"></textarea>
              <div class="text-end">
                <button class="reset_template_options_button btn btn-secondary">Default Settings</button>
              </div>
            </div>
          </div>
          <div class="col-md-6 p-2">
            <div class="h-100 p-4 bg-light rounded-3 border border-secondary">
              <div class="small mb-4 text-muted">Embedding Type</div>
              <select class="form-select embedding_type_select">
                <option>Query Verses to Embed Chapters</option>
                <option>Query Verses to Embed Verses</option>
                <option>Query Chapter to Embed Chapter</option>
              </select>
              <a target="_blank" class="embedding_diagram_anchor"><img class="embedding_diagram_img img-fluid pt-4" src="" alt="" width="100%" height="100%"></a>
              <div class="text-muted small text-center pt-1">Your results will vary based on the retrieval technique</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ul class="nav nav-tabs justify-content-center float-md-end pt-2 p-sm-0" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="augmented_response_button" data-bs-toggle="tab"
          href="#augmented_response_view" role="tab" aria-controls="augmented_response_view" aria-selected="true">
          Chat
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="augmented_template_button" data-bs-toggle="tab" href="#augmented_template_view"
          role="tab" aria-controls="augmented_template_view" aria-selected="false">
          Option
        </a>
      </li>
    </ul>

    <footer class="mt-auto text-muted pt-2 p-sm-0">
      <p>A Bible RAG Demo by <a href="https://unacog.com" class="text-black">Unacog</a>.</p>
    </footer>
  </div>



  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Retrieve by Chapter</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <img src="img/retrievalChapters.png" alt="Chapters" width="100%" height="100%" class="p-3">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel2">Retrieve by Verse</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <img src="img/retrievalVerses.png" alt="Verses" width="100%" height="100%" class="p-3 img-fluid">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <style>
    html {
      height: 100%;
    }

    .verse_card {
      margin: 12px;
      border-radius: 12px;
      border: solid 1px black;
      padding: 12px;
    }

    .message_text,
    .augmented_message_text {
      width: 100%;
      height: 5em;
      margin-bottom: 12px;
    }

    .verse_card .selected {
      font-weight: bold;
    }

    .full_augmented_prompt,
    .full_augmented_response {
      white-space: pre-wrap;
    }

    label {
      font-weight: bold;
    }

    .raw_prompt {
      white-space: pre-wrap;
    }

   .pipeline_detail_anchor_hide {
      display: none;
    }
    .running .pipeline_detail_anchor_hide,
    .complete .pipeline_detail_anchor_hide {
      display: block;
    }
    .initial .initial_user_message {
      display: block;
      text-align: center;
    }
    .initial_user_message {
      display: none;
    }
  </style>
</body>

</html>